package com.excilys.formation.java.cbd.cli;

import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

import com.excilys.formation.java.cbd.dao.CompanieDao;
import com.excilys.formation.java.cbd.dao.ComputerDao;
import com.excilys.formation.java.cbd.model.Companie;
import com.excilys.formation.java.cbd.model.Computer;
import com.excilys.formation.java.cbd.service.ConnectDB;

public class CommandLine {
	private String commandIn;
	private String[] optionList;
	private enum Command{
		Aide,
		Quitter,
		Liste_Ordi,
		Liste_Comp,
		Detail,
		Create,
		Update,
		Delete,
		Default;	
	}
	private Command command;
	ConnectDB con;
	CompanieDao companieDao;
	ComputerDao computerDao;
	List<Companie> companieL =  new LinkedList<Companie>();
	List<Computer> computerL =  new ArrayList<Computer>();
	DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd");
	
	
	public CommandLine(ConnectDB con) {
		this.con = con;
		this.companieDao = new CompanieDao(this.con);
		this.computerDao = new ComputerDao(this.con);
		this.companieL = this.companieDao.findAll();
		this.computerL = this.computerDao.findAll();
	}
	
	public String getCommandIn() {
		return this.commandIn;
	}
	
	public void setCommandIn(String pCommandIn) {
		this.commandIn = pCommandIn;
	}
	
	public String[] getOptionList() {
		return this.optionList;
	}
	
	public void setOptionList() {
		this.optionList = this.commandIn.split(" ");
	}
	
	public void setCommand() {
		if(this.commandIn.equals("h")) {
			this.command = Command.Aide;
		}
		else if(this.commandIn.equals("C")) {
			this.command = Command.Liste_Ordi;
		}
		else if(this.commandIn.contentEquals("Q")) {
			this.command = Command.Liste_Comp;
		}
		else if(this.commandIn.startsWith("c")) {
			this.command = Command.Detail;
		}
		else if(this.commandIn.startsWith("cr")) {
			this.command = Command.Create;
		}
		else if(this.commandIn.startsWith("cu")) {
			this.command = Command.Update;
		}
		else if(this.commandIn.startsWith("cd")) {
			this.command = Command.Delete;
		}
		else {
			this.command = Command.Default;
		}
	}
	
	public void executeCommande() {
		this.setCommand();
		switch(this.command) {
			case Aide:
				this.help();
				break;
			case Liste_Comp:
				this.listCompanies();
				break;
			case Liste_Ordi:
				this.listComputer();
				break;
			case Detail:
				this.detailComputer();
				break;
			case Create:
				break;
			case Update:
				break;
			case Delete:
				break;
			default:
				break;
		}
	}
	
	public void home() {
		System.out.println("Bienvenue dans l'interface de commande pour la gestion de la bdd d'ordinateur\n"
				+ "Taper 'h' pour avoir l'aide sur les différentes commande disponible");
	}
	
	public void help() {
		System.out.println("Liste des différent commande disponible :\n"
				+ "'h' : Aide sur les instructions possible\n"
				+ "'q' : Quitter l'interface de commande\n"
				+ "'C' : Liste des différents ordi de la BDD\n"
				+ "'Q' : Liste des différentes compagnie de la BDD\n"
				+ "'c [id_ordi]' : Détaille sur un ordinateur en particulier\n"
				+ "'cr ['id' 'nom' -c 'compagnie' -i 'dateIn' -o 'dateOut']' : Création d'un nouveau pc, les parametres avec -i -o -c sont optionnels\n"
				+ "'cu ['id' 'nom' -c 'compagnie' -i 'dateIn' -o 'dateOut']' : Maj d'un pc, les parametres avec -i -o -c sont optionnels\n"
				+ "'cd [id]' : Supression d'un ordinateur grace a son id\n"
				+ "WARNING : les dates sont au formats 'yyy-MM-dd'");
		
	}
	
	private Computer createComputerCli() {
		Computer compute = new Computer(Integer.parseInt(optionList[1]), optionList[2]);
		List<Boolean> optionChoose = new ArrayList<Boolean>();
		optionChoose.add(false);
		optionChoose.add(false);
		optionChoose.add(false);
		
		for(int i = 0; i < this.optionList.length; i+=2) {
			if(this.optionList[i].equals("-c")) {
				optionChoose.set(0, true);
				if(this.optionList[i].equals("null")) {
					compute.setManufacturer(0);
				}
				else {
					compute.setManufacturer(Integer.parseInt(this.optionList[i + 1]));
				}
			}
			else if(this.optionList[i].equals("-i")) {
				optionChoose.set(1, true);
				if(this.optionList[i].equals("null")) {
					compute.setDateIn(null);
				}
				else {
					compute.setDateIn(LocalDate.parse(this.optionList[i + 1], formatter));
				}
				
			}
			else if(this.optionList[i].equals("-o")) {
				optionChoose.set(2, true);
				if(this.optionList[i].equals("null")) {
					compute.setDateOut(null);
				}
				else {
					compute.setDateOut(LocalDate.parse(this.optionList[i + 1], formatter));
				}
			}
		}
		
		if(!optionChoose.get(0)) {
			compute.setManufacturer(0);
		}
		if(!optionChoose.get(1)) {
			compute.setDateIn(null);
		}
		if(!optionChoose.get(2)) {
			compute.setDateOut(null);
		}
		
		return compute;
	}
	
	public void listComputer() {
		for(Computer elem:this.computerL) {
			System.out.println(elem);
		}
	}
	
	public void listCompanies() {
		for(Companie elem:this.companieL) {
			System.out.println(elem);
		}
	}
	
	public void detailComputer() {
		int idComputer = Integer.parseInt(this.optionList[1]);
		System.out.println(this.computerDao.find(idComputer));
	}
	
	public void createComputer() {
		this.computerDao.create(createComputerCli());
	}
	
	public void updateComputer() {
		this.computerDao.update(createComputerCli());
	}
	
	public void deleteComputer() {
		int idComputer = this.optionList(Integer.parseInt(this.optionList[1]));
		for(Computer elem:computerL) {
			
		}
		this.computerDao.delete(createComputerCli());
	}
}
